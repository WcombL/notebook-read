# 魔数 0x5f3759df

该数出现在《雷神之锤 三 竞技场》源代码中的一个函数  
该函数主要功能是`求平方根倒数`  

```c
float Q_rsqrt(float number){
  long i;
  float x2, y;
  const float threehalfs = 1.5F;

  x2 = number * 0.5F;
  y = number;
  i = *(long *) &y;
  i = 0x5f2759df - (i >> 1);
  y = *(float *) &i;
  y = y * (threehalfs - (x2 * y * y));

  return y;
}
```

## 计算机浮点数表示

使用IEEE 754标准，以32bits浮点数为例。
- 第一段占 1bit。表示符号位。代称为S(sign)
- 第二段占 8bits。表示指数。代称为E(Exponent)
- 第三段占 23bits。表示尾数。代称为M(Mantissa)

小数计算公式
$$ (-1)^S*(1+\frac {M} {2^{23}})*2^{E-127} $$

- 第一段符号位
- 第二段指数位。指数位就是，对于任意数x，其中都能找到一个n，使 $ 2^n <= x <= 2^{n+1} $
- 第三段尾数位。也就是小数位。看做把 [2^n, 2^(n+1)]分成2^23份，其中2^n到x所占比例

例如：3.14在计算机中表示
- 是正数。所以S = 0
- $$ 2^1 <= 3.14 <= 2^2 $$
  令 n = E - 127，所以E = 128
-(3.14-2)/(4-2) = 0.57，而 0.57 * 2^23 = 4781506.56 四舍五入为4781506
- 把 S M E 转换成二进制，即是3.14的二进制表示

> 因为负数是没有平方根的，所以在这个问题中S总是0

令
$$ m = \frac {M} {2^{23}}$$
$$ e = E -127 $$
那么上面公式可以简化为
$$ (1+m)*2^e  $$
上面这个公式是从一个32bits二进制计算出一个浮点数。而这个 3232bits浮点数的整型算式是
$$ M + E*2{23} $$

例如：0.015的32bits的二进制是：00111100011101011100001010000000。也就是整型的：
$$ 7717519 + 120*2{23} = 1014350479 = 0x3C75C28F $$

## 平方根倒数公式推导
